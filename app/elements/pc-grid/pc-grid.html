<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="pc-grid">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
   <iron-signals on-iron-signal-updategrid="updateGridExternal"></iron-signals>
   
   <table class="table table-striped table-bordered table-hover table-condensed">
      <tbody>
        <tr>
          <th></th>
          <template is="dom-repeat" items="{{metaData.Fields}}">
              <th>{{item.Text}}</th>
          </template>
        </tr>
        <template id="idTemplate" is="dom-repeat" items="{{gridItems}}" as="gitem">
          <tr>
            <td><input type="radio" name="rdoItems" id="{{gitem.Id}}" on-click="onSelect"></td>
            <template is="dom-repeat" items="{{metaData.Fields}}">
              <td>{{getItemValue(gitem, item) }}</th>
            </template>  
          </tr>
        </template>
      </tbody>
   </table>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'pc-grid',

      properties: {
        foo: {
          type: String,
          value: 'pc-grid',
          notify: true
        },
        gridItems: { 
          type: Array,
          notify: true,
          observer: '_gridItemsUpdated'
        },
        selectedItem: {
          notify: true
        },
        dropDownConfig: {},
        dropDownData: { value: {} }
      },
      _gridItemsUpdated: function() {
        console.log('Grid items updated !');
      },
      getItemValue: function(obj, meta) {
        if(meta.ElementType === 'Dropdown')
        {
          return obj[meta.DropdownName];
          //  var ind = _.findIndex(this.dropDownConfig, 'Name', meta.DropdownName);
          //  var dmeta = this.dropDownConfig[ind];
          //  var dval = obj[meta.Name].toString(); 
          //  var dat = this.dropDownData[dmeta.Name];
          //  var datInd = _.findIndex(dat, dmeta.ValueKey, dval); 
          //  return dat[datInd][dmeta.DisplayKey];
      
          // var parent = this;
          // var dynAjax = document.createElement('pc-ajax');
          // console.log('url - ' + dmeta.Url);
          // dynAjax.setAttribute('url', dmeta.Url); 
          // dynAjax.MakeCall(true, function(dat){
          //   parent.dropDownData[dmeta.Name] = dat;
          //   var datInd = _.findIndex(dat, dmeta.ValueKey, dval);
          //   var retVal = dat[datInd][dmeta.DisplayKey];
          //   console.log(retVal); 
          //   return retVal; 
          // });            
        }
        else
        {
          return obj[meta.Name];
        }
      },
      updateGridExternal: function() {
          //this.gridItems = newVal.detail;
          //this.notifyPath('gridItems', newVal.detail.slice());
          //console.log(this.gridItems);
      },
      onSelect: function(val){ 
          this.selectedItem = val.model.gitem; 
      } 
    });
  })();
  </script>
</dom-module>
