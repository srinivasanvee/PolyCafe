<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="pc-grid">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
   <vaadin-grid id="idVadinGrid" on-selected-items-changed="onSelect">
      <table>
        <colgroup> 
        </colgroup>
      </table>
   </vaadin-grid>
    
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'pc-grid',

      properties: {
        foo: {
          type: String,
          value: 'pc-grid',
          notify: true
        },
        gridMetaData: {
          observer: "metaDataUpate"
        },
        gridItems: { 
          observer: "updateGrid",
          type: Array
        },
        selectedItem: {
          notify: true
        }
      },
      
      updateGrid: function(newVal) {
          var grid = this.$.idVadinGrid;
          grid.items = newVal;        
      },
      
      onSelect: function(e){ 
        var grid = this.$.idVadinGrid;
        if(!grid || !grid.items) return;
         
        var ind = grid.selection.selected();
        this.selectedItem = grid.items[ind]; 
      },

      metaDataUpate: function(newVal) {
        var grid = this.$.idVadinGrid;

        _.each(newVal.Fields, function(mdata){
          grid.addColumn( {headerContent: mdata.Name, 
                           name: mdata.Text,
                           hidable: mdata.Hidable, 
                           hidden: mdata.Hidden,
                           sortable: true,
                           direction: "desc" });
        })
        
        grid.frozenColumns = 1;
        grid.visibleRows = newVal.VisibleRows; 
        grid.sortOrder = [{column: 0, direction: "desc"}, {column: 1, direction: "asc"}];
        
        grid.addEventListener('sort-order-changed', function() {
          var idx = grid.sortOrder[0].column;
          var lesser = grid.sortOrder[0].direction == 'asc' ? -1 : 1;
          var items = this.parentNode.gridItems;
          items.sort(function(a, b) {
            return (a[idx] < b[idx]) ? lesser : -lesser;
          });
        });
      }

    });
  })();
  </script>
</dom-module>
